<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERP Compras - C++ Backend</title>
    
    <!-- Fonte Inter para visual moderno -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Ícones -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* --- TEMA PREMIUM (Slate Dark) --- */
        :root {
            /* Paleta de Cores Refinada */
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --bg-body: #0f172a;       /* Slate 900 */
            --bg-surface: #1e293b;    /* Slate 800 */
            --bg-hover: #334155;      /* Slate 700 */
            --border: #334155;        /* Slate 700 */
            
            --text-main: #f8fafc;     /* Slate 50 */
            --text-muted: #94a3b8;    /* Slate 400 */
            
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            
            /* Sombras Suaves */
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        
        body { 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            display: flex; 
            min-height: 100vh; 
            font-size: 15px;
        }

        /* --- SIDEBAR --- */
        aside { 
            width: 280px; 
            background: var(--bg-surface); 
            border-right: 1px solid var(--border); 
            padding: 1.5rem; 
            position: fixed; 
            height: 100%; 
            display: flex;
            flex-direction: column;
            z-index: 50;
        }
        
        .brand { 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            font-size: 1.25rem; 
            font-weight: 700; 
            color: white; 
            margin-bottom: 2.5rem;
            padding: 0 0.5rem;
        }
        
        .brand i { color: var(--primary); }

        nav button { 
            width: 100%; 
            text-align: left; 
            padding: 0.75rem 1rem; 
            border: none; 
            background: transparent; 
            color: var(--text-muted); 
            cursor: pointer; 
            border-radius: 0.5rem; 
            margin-bottom: 0.25rem; 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            font-weight: 500; 
            transition: all 0.2s ease;
        }
        
        nav button:hover { 
            background-color: var(--bg-hover); 
            color: white; 
        }
        
        nav button.active { 
            background-color: var(--primary); 
            color: white; 
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .sidebar-footer { margin-top: auto; }
        .status-badge {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* --- MAIN CONTENT --- */
        main { 
            margin-left: 280px; 
            padding: 2.5rem; 
            width: 100%; 
            max-width: 1600px;
        }

        header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 2.5rem; 
        }
        
        h1 { font-size: 1.8rem; font-weight: 700; letter-spacing: -0.5px; }

        /* --- CARDS --- */
        .grid-cards { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); 
            gap: 1.5rem; 
            margin-bottom: 2.5rem; 
        }
        
        .card { 
            background: var(--bg-surface); 
            padding: 1.5rem; 
            border-radius: 1rem; 
            border: 1px solid var(--border); 
            box-shadow: var(--shadow);
        }
        
        .card h3 { 
            color: var(--text-muted); 
            font-size: 0.85rem; 
            text-transform: uppercase; 
            letter-spacing: 0.05em; 
            margin-bottom: 0.5rem; 
            font-weight: 600;
        }
        
        .card .value { font-size: 2rem; font-weight: 700; color: white; }

        /* --- TABLES --- */
        .table-wrapper {
            background: var(--bg-surface);
            border-radius: 1rem;
            border: 1px solid var(--border);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        table { width: 100%; border-collapse: collapse; text-align: left; }
        
        th { 
            background: rgba(0,0,0,0.2); 
            padding: 1rem 1.5rem; 
            font-size: 0.75rem; 
            text-transform: uppercase; 
            color: var(--text-muted); 
            font-weight: 600; 
            border-bottom: 1px solid var(--border);
        }
        
        td { 
            padding: 1rem 1.5rem; 
            border-bottom: 1px solid var(--border); 
            color: var(--text-main);
        }
        
        tr:last-child td { border-bottom: none; }
        tr:hover td { background-color: var(--bg-hover); }

        /* --- FORMS --- */
        .form-box {
            background: var(--bg-surface);
            padding: 2rem;
            border-radius: 1rem;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }
        
        .form-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 1.5rem; 
            margin-bottom: 1.5rem; 
        }
        
        label { display: block; font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.5rem; font-weight: 500; }
        
        input, select { 
            width: 100%; 
            padding: 0.75rem; 
            background: var(--bg-body); 
            border: 1px solid var(--border); 
            border-radius: 0.5rem; 
            color: white; 
            outline: none; 
            transition: all 0.2s;
        }
        
        input:focus, select:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(59,130,246,0.2); }

        /* --- COMPONENTS --- */
        .btn { 
            background: var(--primary); 
            color: white; 
            border: none; 
            padding: 0.75rem 1.5rem; 
            border-radius: 0.5rem; 
            font-weight: 600; 
            cursor: pointer; 
            display: inline-flex; 
            align-items: center; 
            gap: 0.5rem; 
            transition: background 0.2s; 
        }
        .btn:hover { background: var(--primary-hover); }
        
        .btn-ghost { background: transparent; border: 1px solid var(--border); color: var(--text-muted); }
        .btn-ghost:hover { border-color: var(--text-main); color: var(--text-main); }

        .badge { padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; font-weight: 600; border: 1px solid transparent; }
        .bg-green { background: rgba(16,185,129,0.15); color: #34d399; border-color: rgba(16,185,129,0.2); }
        .bg-red { background: rgba(239,68,68,0.15); color: #f87171; border-color: rgba(239,68,68,0.2); }
        .bg-yellow { background: rgba(245,158,11,0.15); color: #fbbf24; border-color: rgba(245,158,11,0.2); }

        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .dot-green { background: var(--success); box-shadow: 0 0 8px var(--success); }
        .dot-red { background: var(--danger); box-shadow: 0 0 8px var(--danger); }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <aside>
        <div class="brand">
            <i data-lucide="box" size="28"></i>
            <span>ERP System</span>
        </div>
        <nav>
            <button onclick="router('dashboard')" id="nav-dashboard" class="active"><i data-lucide="layout-dashboard" size="20"></i> Dashboard</button>
            <button onclick="router('fornecedores')" id="nav-fornecedores"><i data-lucide="users" size="20"></i> Fornecedores</button>
            <button onclick="router('ordens')" id="nav-ordens"><i data-lucide="shopping-cart" size="20"></i> Ordens</button>
            <button onclick="router('estoque')" id="nav-estoque"><i data-lucide="package" size="20"></i> Estoque</button>
            <button onclick="router('producao')" id="nav-producao"><i data-lucide="clipboard-list" size="20"></i> Solicitações</button>
        </nav>
        <div class="sidebar-footer">
            <div class="status-badge">
                <span style="color: var(--text-muted); font-size: 0.85rem;">Backend</span>
                <div style="display: flex; align-items: center;">
                    <span id="backend-status-dot" class="status-dot dot-red"></span>
                    <strong id="backend-status-text">OFF</strong>
                </div>
            </div>
        </div>
    </aside>

    <main>
        <header>
            <h1 id="page-title">Dashboard</h1>
            <div style="display: flex; gap: 1rem;">
                <button class="btn btn-ghost" onclick="atualizarDados()"><i data-lucide="refresh-cw" size="18"></i> Atualizar</button>
            </div>
        </header>

        <!-- DASHBOARD -->
        <div id="view-dashboard">
            <div class="grid-cards">
                <div class="card"><h3>Saldo</h3><div class="value" id="dash-saldo">R$ --</div></div>
                <div class="card"><h3>Fornecedores</h3><div class="value" id="dash-fornecedores">--</div></div>
                <div class="card"><h3>Estoque Total</h3><div class="value" id="dash-estoque">--</div></div>
                <div class="card"><h3>Ordens</h3><div class="value" id="dash-ordens">--</div></div>
            </div>
        </div>

        <!-- FORNECEDORES -->
        <div id="view-fornecedores" class="hidden">
            <div class="form-box">
                <h3 style="margin-bottom:1.5rem; font-size:1.1rem;">Novo Fornecedor</h3>
                <form onsubmit="cadastrarFornecedor(event)">
                    <div class="form-grid">
                        <div><label>Nome da Empresa</label><input required name="nome" placeholder="Ex: Metalúrgica..."></div>
                        <div><label>CNPJ</label><input required name="cnpj" placeholder="00.000.000/0000-00"></div>
                        <div><label>Endereço</label><input required name="endereco" placeholder="Rua, número"></div>
                        <div><label>Produto Principal</label><input required name="produto"></div>
                        <div><label>Preço Ref. (R$)</label><input required name="preco" type="number" step="0.01"></div>
                    </div>
                    <div style="text-align: right;"><button type="submit" class="btn">Cadastrar</button></div>
                </form>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>ID</th><th>Empresa</th><th>Produto</th><th>Preço</th><th>CNPJ</th><th>Endereço</th></tr></thead>
                    <tbody id="lista-fornecedores"></tbody>
                </table>
            </div>
        </div>

        <!-- ORDENS -->
        <div id="view-ordens" class="hidden">
            <div class="form-box">
                <h3 style="margin-bottom:1.5rem; font-size:1.1rem;">Nova Ordem</h3>
                <form onsubmit="criarOrdem(event)">
                    <div class="form-grid">
                        <div><label>ID Fornecedor</label><input required name="idFornecedor" type="number"></div>
                        <div><label>ID Material</label><input required name="idItem" type="number"></div>
                        <div><label>Quantidade</label><input required name="quantidade" type="number"></div>
                        <div><label>Valor Unit. (R$)</label><input required name="valor" type="number" step="0.01"></div>
                        <div><label>Data Prevista de Chegada</label><input name="data_chegada" type="date"></div>
                    </div>
                    <div style="text-align: right;"><button type="submit" class="btn">Lançar Ordem</button></div>
                </form>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>ID</th><th>Item</th><th>Qtd</th><th>Total</th><th>Status</th><th>Chegada Prevista</th></tr></thead>
                    <tbody id="lista-ordens"></tbody>
                </table>
            </div>
        </div>

        <!-- ESTOQUE -->
        <div id="view-estoque" class="hidden">
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>ID</th><th>Material</th><th>Quantidade</th><th>Status</th></tr></thead>
                    <tbody id="lista-estoque"></tbody>
                </table>
            </div>
            <h3 style="margin: 2rem 0 1rem; font-size:1.1rem;">Estoque Previsto</h3>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Material</th><th>Qtd Prevista</th><th>Ordem de Compra</th><th>Data Prevista</th></tr></thead>
                    <tbody id="lista-estoque-previsto"></tbody>
                </table>
            </div>
        </div>

        <!-- SOLICITAÇÕES DA PRODUÇÃO -->
        <div id="view-producao" class="hidden">
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>ID</th><th>Material</th><th>Qtd Solicitada</th><th>Prioridade</th><th>Status</th><th>OC Origem</th></tr></thead>
                    <tbody id="lista-producao"></tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        lucide.createIcons();
        
        // --- CONFIG ---
        const API_URL = 'http://localhost:8080/api';
        
        const MOCK = {
            '/estoque': [
                {id:1, nome:'Aço Inox', quantidade:120},
                {id:2, nome:'Parafusos M10', quantidade:5000},
                {id:3, nome:'Borracha', quantidade:45}
            ],
            '/estoque/previsto': [
                {idMaterial:1, quantidade:50, idOrdemCompra:1, dataPrevista:'2025-01-20'}
            ],
            '/fornecedores': [
                {id:1, nome:'Metalúrgica Alpha', produto:'Aço', preco:150.00, cnpj:'12.345.678/0001-90', endereco:'Rua Industrial, 500'},
                {id:2, nome:'Parafusos Express', produto:'Parafusos', preco:0.50, cnpj:'98.765.432/0001-10', endereco:'Av. Logística, 100'}
            ],
            '/ordens': [
                {id:1, idItem:1, quantidade:10, valor:1500.00, status:1, data_chegada:'2025-01-20'},
                {id:2, idItem:2, quantidade:1000, valor:500.00, status:0, data_chegada:'2025-01-25'}
            ],
            '/producao': [
                {id:1, idMaterial:1, quantidade:50, prioridade:3, status:'pendente', idOrdemCompra:1}
            ],
            '/financeiro': {saldo: 95000.00}
        };

        function router(view) {
            document.querySelectorAll('main > div').forEach(d => d.classList.add('hidden'));
            document.getElementById(`view-${view}`).classList.remove('hidden');
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(`nav-${view}`).classList.add('active');
            
            const titles = {
                'dashboard':'Visão Geral',
                'fornecedores':'Fornecedores',
                'ordens':'Gestão de Compras',
                'estoque':'Inventário',
                'producao':'Solicitações da Produção'
            };
            document.getElementById('page-title').innerText = titles[view];
            atualizarDados();
        }

        async function fetchAPI(endpoint) {
            try {
                const res = await fetch(`${API_URL}${endpoint}`);
                if (!res.ok) throw new Error();
                document.getElementById('backend-status-dot').className = 'status-dot dot-green';
                document.getElementById('backend-status-text').innerText = 'ON';
                return await res.json();
            } catch {
                document.getElementById('backend-status-dot').className = 'status-dot dot-red';
                document.getElementById('backend-status-text').innerText = 'OFF';
                await new Promise(r => setTimeout(r, 100)); 
                return MOCK[endpoint] || [];
            }
        }

        async function atualizarDados() {
            // Estoque
            const estoque = await fetchAPI('/estoque');
            document.getElementById('lista-estoque').innerHTML = estoque.map(i => `
                <tr><td>#${i.id}</td><td>${i.nome}</td><td>${i.quantidade}</td>
                <td>${i.quantidade < 50 ? '<span class="badge bg-red">Baixo</span>' : '<span class="badge bg-green">OK</span>'}</td></tr>`).join('');
            document.getElementById('dash-estoque').innerText = estoque.reduce((a,b)=>a+(b.quantidade||0),0);

            // Estoque Previsto
            const previsto = await fetchAPI('/estoque/previsto');
            document.getElementById('lista-estoque-previsto').innerHTML = previsto.map(p => `
                <tr><td>Item #${p.idMaterial}</td><td>${p.quantidade}</td><td>#${p.idOrdemCompra||'-'}</td><td>${p.dataPrevista||'-'}</td></tr>`).join('');

            // Fornecedores
            const forn = await fetchAPI('/fornecedores');
            document.getElementById('lista-fornecedores').innerHTML = forn.map(f => `
                <tr><td>#${f.id}</td><td>${f.nome}</td><td>${f.produto}</td><td>R$ ${f.preco.toFixed(2)}</td><td>${f.cnpj}</td><td>${f.endereco||'-'}</td></tr>`).join('');
            document.getElementById('dash-fornecedores').innerText = forn.length;

            // Ordens
            const ordens = await fetchAPI('/ordens');
            document.getElementById('lista-ordens').innerHTML = ordens.map(o => {
                const badge = o.status===1 ? 'bg-green' : (o.status===2 ? 'bg-red' : 'bg-yellow');
                const st = ['Pendente','Aprovado','Rejeitado','Enviado','Entregue'][o.status] || 'Outro';
                const total = (o.valor||0) * (o.quantidade||0);
                return `<tr><td>#${o.id}</td><td>Item #${o.idItem}</td><td>${o.quantidade}</td><td>R$ ${total.toFixed(2)}</td>
                <td><span class="badge ${badge}">${st}</span></td><td>${o.data_chegada||'-'}</td></tr>`;
            }).join('');
            document.getElementById('dash-ordens').innerText = ordens.length;

            // Solicitações da Produção
            const prod = await fetchAPI('/producao');
            document.getElementById('lista-producao').innerHTML = prod.map(p => {
                const prioLabel = p.prioridade===3 ? 'Alta' : (p.prioridade===2 ? 'Média' : 'Baixa');
                return `<tr><td>#${p.id}</td><td>Item #${p.idMaterial}</td><td>${p.quantidade}</td><td>${prioLabel}</td><td>${p.status}</td><td>#${p.idOrdemCompra||'-'}</td></tr>`;
            }).join('');

            // Financeiro
            const fin = await fetchAPI('/financeiro');
            if(fin) document.getElementById('dash-saldo').innerText = `R$ ${(fin.saldo||0).toLocaleString('pt-BR')}`;
        }

        async function cadastrarFornecedor(e) {
            e.preventDefault();
            try { 
                await fetch(`${API_URL}/fornecedores?${new URLSearchParams(new FormData(e.target))}`, {method:'POST'}); 
                alert('Fornecedor cadastrado!'); 
            } catch { 
                alert('Backend OFF: Cadastro simulado'); 
            }
            e.target.reset(); 
            atualizarDados();
        }

        async function criarOrdem(e) {
            e.preventDefault();
            try { 
                const res = await fetch(`${API_URL}/ordens?${new URLSearchParams(new FormData(e.target))}`, {method:'POST'});
                const d = await res.json();
                alert(d.sucesso ? 'Ordem criada e registrada no estoque previsto!' : 'Erro: '+d.msg);
            } catch { 
                alert('Backend OFF: Ordem simulada'); 
            }
            e.target.reset(); 
            atualizarDados();
        }

        atualizarDados();
        setInterval(atualizarDados, 5000);
    </script>
</body>
</html>
